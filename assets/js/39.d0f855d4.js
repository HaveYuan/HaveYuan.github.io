(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{543:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("最近在重构公司的小程序，用的框架是uni-app，记录一下使用中的一些踩坑点")]),t._v(" "),s("h2",{attrs:{id:"check-group组件在百度小程序中的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#check-group组件在百度小程序中的问题"}},[t._v("#")]),t._v(" check-group组件在百度小程序中的问题")]),t._v(" "),s("p",[t._v("在项目中有用到 "),s("code",[t._v("checkbox-group")]),t._v(" 这个组件，这个组件在百度小程序里的问题比较多，已知的有：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("重新渲染 "),s("code",[t._v("checkbox-group")]),t._v(" 的数据时会多次触发表单的change事件")]),t._v(" "),s("p",[t._v("如图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/uniapp_use/1.webp",alt:"图片"}})]),t._v(" "),s("p",[t._v("只要一重新赋值就会触发 "),s("code",[t._v("change")]),t._v(" 事件，微信小程序不会有这种情况。")])]),t._v(" "),s("li",[s("p",[t._v("重新赋值时表单会带上上一次表单选择的值")]),t._v(" "),s("p",[t._v("还是看上图所示： 本来是只有 "),s("code",[t._v("1-6")]),t._v(" 的，重新赋值后变为 "),s("code",[t._v("1-12")]),t._v(" 了，把上一次里的值也带进去了。")])]),t._v(" "),s("li",[s("p",[t._v("百度小程序选择其中一个 "),s("code",[t._v("checkbox")]),t._v(" 后所有 "),s("code",[t._v("checkbox")]),t._v(" 的checked会变为 "),s("code",[t._v("false")])]),t._v(" "),s("p",[t._v("这个在我做的demo里没有复现，但在项目中是确实存在的，不清楚在什么条件下才会复现，先记录下")])]),t._v(" "),s("li",[s("p",[t._v("如果值类型是Number类型的话，选择表单后返回的值在微信小程序里为String类型，在百度小程序里则还是Number类型")]),t._v(" "),s("p",[t._v("如下图所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/uniapp_use/2.webp",alt:"百度小程序结果"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/uniapp_use/3.webp",alt:"微信小程序结果"}})]),t._v(" "),s("p",[t._v("这个其实不算百度小程序的问题，百度小程序能正常返回值类型，而微信小程序是直接把值转为String类型了，这样在进行比较的时候比如用 "),s("code",[t._v("indexOf()")]),t._v(" 时会有一些问题")])])]),t._v(" "),s("p",[s("em",[t._v("解决方案：")])]),t._v(" "),s("p",[t._v("这个在之前做百度小程序的时候就发现了，当时是用原生开发的，所以直接做了兼容处理，但现在要一码多端，如果单独针对百度小程序进行兼容的话后期也不太好维护，所以就放弃使用这个组件，改用 "),s("code",[t._v("view")]),t._v(" 布局加 "),s("code",[t._v("js")]),t._v(" 的方式实现所需逻辑以此来方便对其它端的兼容。")]),t._v(" "),s("h2",{attrs:{id:"数组更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数组更新"}},[t._v("#")]),t._v(" 数组更新")]),t._v(" "),s("p",[t._v("数组更新时，如果新数组比旧数组少的时候lenght的值可以更新到，如果新数组比旧数组多了则不能更新到")]),t._v(" "),s("p",[t._v("比方说这里有三个数组")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'javascript'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wxml'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'javascript'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'javascript'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'css'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wxml'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'wxss'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("code",[t._v("arr")]),t._v(" 是页面上要显示的，它的长度是3，如果把 "),s("code",[t._v("arr1")]),t._v(" 赋值给 "),s("code",[t._v("arr")]),t._v(" 的话是正常的，长度会变成2， 但是把 "),s("code",[t._v("arr2")]),t._v(" 赋值给 "),s("code",[t._v("arr")]),t._v(" 的话就有问题了，内容可以正常更新，但是它的 "),s("code",[t._v("length")]),t._v(" 值还是上一次显示的2，说明只更新了内容而长度值没有更新到，这样我们在页面根据数组的长度进行判断做一些处理的话就会出现问题了。")]),t._v(" "),s("p",[t._v("这个问题我猜想是跟vue有关，毕竟uni-app也是基于vue的，所以我查了一下vue文档，找到了 "),s("a",{attrs:{href:"https://cn.vuejs.org/v2/guide/list.html#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://cn.vuejs.org/v2/guide/list.html#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"),s("OutboundLink")],1),t._v(" 中的第2点，官网给出的解决方案是使用"),s("a",{attrs:{href:"https://cn.vuejs.org/v2/api/#Vue-set",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue.set()"),s("OutboundLink")],1),t._v("方法 ，不过有一个限制，不能是 Vue 实例，或者 Vue 实例的根数据对象，由于我在项目中用到这个值刚好是根数据对象，所以这个方法我试了一下没用，最后的解决方案是将长度用另一个单独的值进行赋值。")]),t._v(" "),s("h2",{attrs:{id:"navigator样式问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#navigator样式问题"}},[t._v("#")]),t._v(" navigator样式问题")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/uniapp_use/4.webp",alt:"图片"}})]),t._v(" "),s("p",[t._v("如果直接选择navigator设置标签在百度小程序中是无效的，编译出来是以swan-nav的形式存在的，所以要给navigator设置样式的话建议设置一个类名")]),t._v(" "),s("h2",{attrs:{id:"尽量少用block标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#尽量少用block标签"}},[t._v("#")]),t._v(" 尽量少用block标签")]),t._v(" "),s("p",[t._v("如果可以在原标签上进行for循环或if判断的尽量不要在外层再套一层block，因为编译之后uni-app会自动在外层套一层block，如果再套一层的话编译之后就变成两层了，会增加不必要的代码量")]),t._v(" "),s("h2",{attrs:{id:"不能编译-i-标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不能编译-i-标签"}},[t._v("#")]),t._v(" 不能编译"),s("code",[t._v("<i>")]),t._v("标签")]),t._v(" "),s("p",[s("code",[t._v("<i></i>")]),t._v(" 标签编译出来会转为 "),s("code",[t._v("<view></view>")]),t._v(" 标签，有使用到的要注意下样式")]),t._v(" "),s("h2",{attrs:{id:"为input赋值时如果值跟上次赋值一样不会触发页面更新"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为input赋值时如果值跟上次赋值一样不会触发页面更新"}},[t._v("#")]),t._v(" 为input赋值时如果值跟上次赋值一样不会触发页面更新")]),t._v(" "),s("p",[t._v("在页面里有一个输入框，它会根据输入的内容进行正则判断从而返回符合要求的值，在uni-app里发现如果返回的值跟上次的值是一样的不会触发页面更新，比如你输入5.922，它会返回5.92，但是如果你再继续在5.92后输入的话比如5.923，它还是返回5.92，跟上次一样所以不会触发更新，因此输入框里显示的还是5.923，不符合提交要求。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/uniapp_use/5.webp",alt:"图片"}})]),t._v(" "),s("p",[t._v("发现在vue里也有这个问题，但是vue可以通过绑定v-model解决，uni-app试了v-model发现没效果，目前的解决方案是在输入时先清空原来的值再设置一个定时器去再次更新，大概如下：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inputVal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeOut")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("_")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inputVal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newVal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])]),s("p",[t._v("最终效果如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/uniapp_use/6.webp",alt:"图片"}})]),t._v(" "),s("h2",{attrs:{id:"页面结构化数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#页面结构化数据"}},[t._v("#")]),t._v(" 页面结构化数据")]),t._v(" "),s("p",[s("code",[t._v("wx:scope-data")]),t._v(" 是微信小程序搜索SEO能力提供的结构化数据格式，使用方式如下:")]),t._v(" "),s("p",[s("code",[t._v('<view class="layout_a" wx:scope-data="'+t._s.apply(void 0,t.articleobjforwx)+'">')])]),t._v(" "),s("p",[t._v("如果在uni-app中则写法如下")]),t._v(" "),s("p",[s("code",[t._v('<view class="layout_a" :wx:scope-data="\''+t._s.apply(void 0,t.articleobjforwx)+"'\">")])]),t._v(" "),s("p",[t._v("注意 "),s("code",[t._v(t._s.apply(void 0,t.articleobjforwx))]),t._v(" 外面还有一对单引号 "),s("code",[t._v("''")]),t._v(" ，这样才能保证编译出来的跟前面保持一致，一开始我用了这种写法 "),s("code",[t._v(':wx:scope-data="articleobjforwx"')]),t._v(" 编译出来的结果是下面这种格式的")]),t._v(" "),s("p",[s("code",[t._v('<view class="layout_a" wx:scope-data="'+t._s(t.articleobjforwx)+'">')])]),t._v(" "),s("p",[t._v("双括号内少了前面三个点，微信小程序识别不到数据，所以我才使用上面的方法，用单引号把整个内容包起来当做一个字符串，这样编译出来就跟微信要求的格式一样了。")]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("uni-app虽然好用，但是要注意的点还蛮多的，毕竟各个平台都有差异，想要完全兼容是不太可能的，这就需要我们对各个平台的小程序比较熟悉，出现问题能及时找到原因并解决。")]),t._v(" "),s("cheers"),t._v(" "),s("pay")],1)}),[],!1,null,null,null);a.default=e.exports}}]);