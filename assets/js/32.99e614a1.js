(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{536:function(e,t,s){"use strict";s.r(t);var a=s(4),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[e._v("#")]),e._v(" 背景")]),e._v(" "),s("p",[e._v("10月12日微信官方发布了小程序模板消息能力调整的通知 https://developers.weixin.qq.com/community/develop/doc/00008a8a7d8310b6bf4975b635a401\n相比之前的有了较大的调整，主要的调整就是从开发者主动下发消息改为用户自主订阅，也就是说必须要用户手动订阅才行，而订阅消息又分为了一次性订阅消息和长期性订阅消息，长期性订阅消息需要有特定公共服务业务这里就不介绍了，本文主要讲的是一次性订阅消息。")]),e._v(" "),s("h2",{attrs:{id:"开发准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开发准备"}},[e._v("#")]),e._v(" 开发准备")]),e._v(" "),s("p",[e._v("如果还没有开通订阅消息的要在小程序后台里开通订阅消息后添加需要的模板，添加完后的红框中的变量就是订阅消息接口要用到的data了")]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/1.webp",alt:"图片"}})]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/2.webp",alt:"图片"}})]),e._v(" "),s("h2",{attrs:{id:"编写云函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编写云函数"}},[e._v("#")]),e._v(" 编写云函数")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("新建云函数，appid跟secret填你自己的即可，\n由于订阅消息需要access_token，所以在使用订阅消息接口前要先获取access_token，这里我把他们都放在一个云函数里了")])]),e._v(" "),s("li",[s("p",[e._v("新建好后要安装依赖，这里用到了"),s("code",[e._v("request-promise")]),e._v("模块，所以要在该目录下"),s("code",[e._v("npm install request-promise")])])]),e._v(" "),s("li",[s("p",[e._v("代码如下")])])]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/3.webp",alt:"图片"}})]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/4.webp",alt:"图片"}})]),e._v(" "),s("h2",{attrs:{id:"页面调用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#页面调用"}},[e._v("#")]),e._v(" 页面调用")]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/5.webp",alt:"图片"}})]),e._v(" "),s("p",[e._v("传入对应的参数即可")]),e._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[e._v("返回结果")])]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/6.webp",alt:"图片"}})]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/7.webp",alt:"图片"}})]),e._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),s("p",[e._v("总的来说并不难，只是有个地方要注意一下，由于之前没怎么用过云开发，不知道它返回的数据结构会有差异，比如在获取access_token的时候发现一个特别之处，在小程序里进行调用的时候，成功的话返回是下图这种格式的")]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/8.webp",alt:"图片"}})]),e._v(" "),s("p",[e._v("但是本地调试的时候返回又是这种格式的")]),e._v(" "),s("p",[s("img",{attrs:{src:"/blog/news/9.webp",alt:"图片"}})]),e._v(" "),s("p",[e._v("少了外面一层object，导致我判断access_token一直报错，调试了好久才发现，好在最后是可以成功获取到。")]),e._v(" "),s("p",[e._v("再来说这次调整，作为用户的我来说我觉得是很ok的，起码我可以选择不接收订阅消息，不像之前那样莫名其妙的就收到了一个订阅消息还不知道是哪个程序的，我是很反感这种的。但是对于一些企业来说可能就不是那么友好了，降低了触达用户的机会。但是不管怎样，身为开发者的可是有得忙了。")]),e._v(" "),s("p",[e._v("代码就不放了，都在图片里，自己动手敲一遍比较好")]),e._v(" "),s("h2",{attrs:{id:"相关接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#相关接口"}},[e._v("#")]),e._v(" 相关接口")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("订阅接口"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/access-token/auth.getAccessToken.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("获取access_token接口"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("下发消息接口"),s("OutboundLink")],1)]),e._v(" "),s("cheers"),e._v(" "),s("pay")],1)}),[],!1,null,null,null);t.default=r.exports}}]);